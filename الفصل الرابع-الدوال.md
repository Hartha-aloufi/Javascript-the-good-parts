#### الفصل الرابع

# الدوال



أفضل شيئ في الجافا سكربت هو تطبيقها للدوال. لقد فعلت كل شيئ تقريباً بشكل صحيح. لكن، كما يمكن أن تتوقع من الجافا سكربت، فهي لم تفعل كل شيئ تمام بشكل صحيح.

الدالة تشتمل على مجموعة من الجمل. وهي الوحد e fundamental modular unit of JavaScript. فهي تستخدم لإخفاء المعلموات وإعادة استخدام الشيفرة والتكوين(composition). تستخدم الدوال لتحديد سلوك الكائنات. بشكل عام، صنعة البرمجة هي تحويل مجموعة من المتطلبات الى مجموعة من الدوال وهياكل البيانات. 

### كائنات الدوال

الدوال هي كائنات في الجافا سكربت، والكائان هو تجميعة من زوجي "اسم/قيمة" يمتلك رابطاً خفياً الى كائن نماذجي(prototype object). الكائنات الناشئة من كائن حرفي مرتبطة ب `Object.prototype`. أما كائنات الدوال فمرتبطة ب `Function.prototype` والذي هو بدووره مرتبطٌ ب `Object.prototype`. كل الدوال تمتلك خاصيتين إضافيتين تنشئان معها: سياق الدالة(context) والشيفرة التي تطبق سلوك الدالة.

جميع كائنات الدوال تمتلك خاصية `prototype` تنشأ معها. قيمتها عبارة عن كائن يحوي خاصية تسمى `constructor` -أي الباني من كلمة بناء- والذي هو قيمته الدالة نفسها. وهذا مختلف عن الرابك المخفي ل `Function.prototype`. المعنى الشائك لهذا الباني سيتم شرحه في الفصل القادم.

بما أن الدوال هي كائنات، فيمكن معاملتها مثل أي قيمة أٌخرى. الدوال يمكن تخزينها في المتغيرات والمصفوفات والكائنات. الدوال يمكن تمريرها كوسائط لدوالٍ أٌخرى. وأيضاً، بما أن الدوال هي في الأصل كائنات، فيمكنها أن تمتلك توابع. والأمر المميز في الدوال هو إمكانية استدعائها.



### الدالة الحرفيّة

كائنات الدوال تنشئ بواسطة الدوال الحرفية:

```javascript
// أنشء متغاً باسم add وخزن به دالة
// تقوم بجمع رقمين
var add = function (a, b) {
 return a + b;
};
```

الدالة الحرفية تمتلك أربعة أجزاء. الجزء الأول هو الكلمة المحجوزة `function`. 

الجزء الثاني اختياري، وهو اسم الدالة. ومكن للدالة استخدامُ ذلك الاسم لمناداة نفسها عَوْدياً(recursively). ويستخدم الاسم أيضاً بواسطة المصححات(debugger) وأدوات التطوير(development tools) للتعرف على الدالة. إذا لم يعطى للدالة اسم كما في المثال السابق، فعندها تسمى دالة مجهولة(anonymous).

الجزء الثالث هو مجموعة الوسائط الخاصة بالدالة، محاطة بأقواس ويفصل بينها بالفواصل. وهذه الوسائط سيتم تعريفها كمتغيرات في الدالة. وعلى عكس المتغيرات العادية التي يتم تهيئتها بقيمة `undefined` فإنها تهيَّأ بقيمة الوسائط المرسلة مع استدعاء الدالة.

الجزء الرابع هو مجموعة من الكلمات محاطة بحاصرتين، هذه الجمل هي جسم الدالة. حيث يتم تنفيذها عند استدعاء الدالة.

يمكن للدالة الحرفية أن تظهر في أي مكان تظهر فيه التعابير. وأيضاً يمكن تعريف الدوال داخل دالة أُخرى. بالطبع يكون لهذه الدالة وسائط ومتغيرات خاصة بها. وللدالة الداخلية القدرة على الوصول لوسائط ومتغيرات الدالة الخارجية أيضاً. يحتوي كائن الدالة المنشئ بواسطة الدالة الحرفية على رابط للسياق الخارجي(outer context). وهذا يدعى بالمغلف(closure) وهو مصدر لقوة هائلة. 

### الاستدعاء

استدعاء الدالة يعلق تنفيذ الدالة الحالية ويمرر التحكم والعوامل(parameters) للدالة الجديدة. بالإضافة الى العوامل المصرح بها، تستقبل كل الدوال عاملين إضافيين: `this` و`arguments`. العامل `this` مهم جداً في البرمجة الموجهة للكائنات

